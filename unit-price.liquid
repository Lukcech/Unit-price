<script>
// přidej EventListener, jakmile se web načte
  document.addEventListener('DOMContentLoaded', () => {
    const productForm = document.querySelector('[data-product-form]');
    if (!productForm) return;

    const updateUnitPrice = (variant) => {
      const unitPriceElement = document.querySelector('.unit-price');
      if (!unitPriceElement || !variant) {
        if(unitPriceElement) unitPriceElement.style.display = 'none';
        return;
      }
      const data = window.variantMetafields ? window.variantMetafields[variant.id] : null;
      const pocetKusu = data ? data.pocet_kusu : 0;

      if (pocetKusu > 0) {
        const cenaZaJednotku = variant.price / pocetKusu;
        const formattedPrice = new Intl.NumberFormat('cs-CZ', { style: 'currency', currency: 'CZK' }).format(cenaZaJednotku / 100);
        unitPriceElement.innerHTML = `Cena za jednotku: ${formattedPrice} / kus`;
        unitPriceElement.style.display = 'block';
      } else {
        unitPriceElement.style.display = 'none';
      }
    };

    productForm.addEventListener('change', (event) => {
      const newVariant = event.dataset.variant;
        if (newVariant) {
          updateUnitPrice(newVariant);
        }
    });

    const initialVariantId = {{ product.selected_or_first_available_variant.id | default: 'null' }};
    if (initialVariantId && window.variantMetafields && window.variantMetafields[initialVariantId]) {
       const initialVariant = {
          id: initialVariantId,
          price: {{ product.selected_or_first_available_variant.price | default: 0 }}
        };
       updateUnitPrice(initialVariant);
    }
  });
</script>